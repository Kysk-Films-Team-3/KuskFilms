spring:
  application:
    name: kyskfilms-backend

  liquibase:
     enabled: false
  datasource:
    # Значение по умолчанию теперь указывает на DNS-имя сервиса в Docker
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://postgres:5432/kyskfilms_db}
    username: ${SPRING_DATASOURCE_USERNAME:kysk_user}
    password: ${SPRING_DATASOURCE_PASSWORD:kyskfilms_secure_password}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10
      connection-timeout: 30000

  jpa:
    hibernate:
      ddl-auto: ${JPA_DDL_AUTO:update}
    show-sql: ${JPA_SHOW_SQL:false}
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true

  security:
    oauth2:
      resourceserver:
        jwt:
          # Значение по умолчанию теперь указывает на ПУБЛИЧНЫЙ адрес через Nginx
          issuer-uri: ${KEYCLOAK_ISSUER_URI:http://localhost/auth/realms/kyskfilms}
          # Значение по умолчанию теперь указывает на ВНУТРЕННИЙ адрес для прямого доступа
          jwk-set-uri: ${KEYCLOAK_JWK_SET_URI:http://keycloak:8080/auth/realms/kyskfilms/protocol/openid-connect/certs}

server:
  port: ${SERVER_PORT:8081}
  # Контекстный путь убран, так как Nginx уже добавляет /api
  # servlet:
  #   context-path: /

# Секция keycloak: удалена, так как она избыточна и может вызвать путаницу.
# Используйте стандартные свойства spring.security.oauth2.

# MinIO configuration
minio:
  # Значение по умолчанию теперь указывает на DNS-имя сервиса в Docker
  url: ${MINIO_URL:http://minio:9000}
  access-key: ${MINIO_ACCESS_KEY:minioadmin}
  secret-key: ${MINIO_SECRET_KEY:minioadmin_secure}
  bucket: ${MINIO_BUCKET:kyskfilms}
  region: ${MINIO_REGION:us-east-1}

# Frontend configuration
app:
  frontend:
    allowed-origins: ${FRONTEND_ALLOWED_ORIGINS:http://localhost,http://localhost:3000,http://localhost:3001}

# Logging
logging:
  level:
    com.kyskfilms: ${LOG_LEVEL_APP:INFO}
    org.springframework.security: ${LOG_LEVEL_SECURITY:INFO}
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# Swagger/OpenAPI
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    # ВАЖНО: client-id для Swagger нужно указать явно или через переменную
    oauth:
      client-id: ${KEYCLOAK_CLIENT_ID:kyskfilms-backend}
      # realm не нужен, если issuer-uri полный
      # realm: ${KEYCLOAK_REALM:kyskfilms}

# Actuator
management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus
      base-path: /actuator
  endpoint:
    health:
      show-details: always