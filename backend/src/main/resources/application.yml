

# ===================================================================
# KYSKFilms Backend - application.yml (ФИНАЛЬНАЯ ЧИСТАЯ ВЕРСИЯ)
# ===================================================================

# -------------------------------------------
# Spring Boot Core
# -------------------------------------------
spring:
  application:
    name: kyskfilms-backend
  liquibase:
    enabled: false

  servlet:
    multipart:
      max-file-size: 10GB        # Максимальный размер одного файла
      max-request-size: 10GB     # Максимальный размер всего запроса
  # -------------------------------------------
  # Database Configuration
  # -------------------------------------------
  datasource:
    url: ${SPRING_DATASOURCE_URL}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10
      connection-timeout: 30000

  # -------------------------------------------
  # JPA & Hibernate Configuration
  # -------------------------------------------
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true

  # -------------------------------------------
  # Security Configuration (OAuth2 / JWT)
  # -------------------------------------------
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${KEYCLOAK_ISSUER_URI}
          jwk-set-uri: ${KEYCLOAK_JWK_SET_URI}

# -------------------------------------------
# Server Configuration
# -------------------------------------------
server:
  port: 8081
  forward-headers-strategy: framework

# -------------------------------------------
# MinIO (S3 Storage) Configuration
# -------------------------------------------
minio:
  url: ${MINIO_URL}
  access-key: ${MINIO_ACCESS_KEY}
  secret-key: ${MINIO_SECRET_KEY}
  bucket: ${MINIO_BUCKET}
  region: ${MINIO_REGION}
  public:
    url: http://placeholder.com

# -------------------------------------------
# Application-specific Configuration
# -------------------------------------------
app:
  backend-url: http://localhost:8081
  frontend:
    allowed-origins:
      - http://localhost
      - http://localhost:3000

# -------------------------------------------
# Logging Configuration
# -------------------------------------------
logging:
  level:
    # Глобально показываем только предупреждения и ошибки (убираем лишние INFO от Spring)
    root: WARN

    # Для нашего кода оставляем INFO (чтобы видеть запуск сервисов)
    com.kyskfilms: INFO

    # Убираем болтливость Hibernate и Security, если они не нужны для отладки
    org.hibernate: ERROR
    org.springframework.security: WARN
    org.springframework.web: WARN

  # Делаем формат логов компактнее (опционально)
  pattern:
    console: "%d{HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# -------------------------------------------
# Swagger / OpenAPI Configuration
# -------------------------------------------
springdoc:
  swagger-ui:
    path: /swagger-ui.html
    oauth:
      client-id: "kyskfilms-swagger"
      use-pkce-with-authorization-code-grant: true
  # Явно указываем внешние ссылки (localhost), чтобы браузер мог по ним пройти
  oauth2:
    authorization-url: http://localhost/auth/realms/${KEYCLOAK_REALM}/protocol/openid-connect/auth
    token-url: http://localhost/auth/realms/${KEYCLOAK_REALM}/protocol/openid-connect/token

# -------------------------------------------
# Actuator Configuration
# -------------------------------------------
management:
  endpoints:
    web:
      exposure:
        include: health,info
      base-path: /actuator
  endpoint:
    health:
      show-details: always